<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Redirecting to PraiseUp</title>

        <!-- update the version number as needed -->
        <script
            defer
            src="/__/firebase/10.13.2/firebase-app-compat.js"></script>
        <script
            defer
            src="/__/firebase/10.13.2/firebase-auth-compat.js"></script>
        <script
            defer
            src="/__/firebase/10.13.2/firebase-database-compat.js"></script>
        <script
            defer
            src="/__/firebase/10.13.2/firebase-firestore-compat.js"></script>
        <script
            defer
            src="/__/firebase/10.13.2/firebase-functions-compat.js"></script>
        <script
            defer
            src="/__/firebase/10.13.2/firebase-messaging-compat.js"></script>
        <script
            defer
            src="/__/firebase/10.13.2/firebase-storage-compat.js"></script>
        <script
            defer
            src="/__/firebase/10.13.2/firebase-analytics-compat.js"></script>
        <script
            defer
            src="/__/firebase/10.13.2/firebase-remote-config-compat.js"></script>
        <script
            defer
            src="/__/firebase/10.13.2/firebase-performance-compat.js"></script>
        <script defer src="/__/firebase/init.js?useEmulator=true"></script>

        <style>
            body {
                background: #eceff1;
                color: rgba(0, 0, 0, 0.87);
                font-family: Roboto, Helvetica, Arial, sans-serif;
                margin: 0;
                padding: 0;
            }
            #message {
                background: #f2f2f2;
                max-width: 360px;
                margin: 100px auto 16px;
                padding: 32px 24px;
                border-radius: 18px;
                text-align: center;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            #loading-spinner {
                margin: 16px auto;
                border: 4px solid rgba(0, 0, 0, 0.1);
                border-top: 4px solid #039be5;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
            }

            #message h1 {
                font-size: 22px;
                font-weight: 300;
                color: rgba(0, 0, 0, 0.6);
                margin: 0 0 16px;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            @media (max-width: 600px) {
                body,
                #message {
                    margin-top: 0;
                    background: white;
                    box-shadow: none;
                }

                body {
                    border-top: 16px solid #039be5;
                }
            }
        </style>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const url = window.location.pathname;
                const segments = url.split("/");

                const uuidRegex =
                    /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;

                if (
                    segments.length >= 3 &&
                    (segments[1] === "song" || segments[1] === "album") &&
                    uuidRegex.test(segments[2])
                ) {
                    const id = segments[2];
                    const scheme = segments[1];

                    if (navigator.userAgent.includes("Android")) {
                        window.location.href = `praiseup://home/${scheme}/${id}`;
                    } else {
                        document.querySelector("#message h1").textContent =
                            "This link only works on Android devices.";
                    }
                } else {
                    document.querySelector("#message h1").textContent =
                        "Invalid URL, please check the link.";
                }
            });
        </script>
    </head>

    <body>
        <div id="message">
            <h1>Redirecting to PraiseUp...</h1>
            <div id="loading-spinner"></div>
            <p>
                If you are not redirected, please ensure the app is installed.
            </p>
        </div>
    </body>
</html>
